<!doctype html><html lang=zh-TW><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Openstack on AArch64/Arm64 via Kolla Ansible - 伊達's work</title><meta name=Description content><meta property="og:url" content="https://blog.kojuro.date/2018/10/2018-10-14-openstack-on-aarch64-arm64-via-kolla-ansible/"><meta property="og:site_name" content="伊達's work"><meta property="og:title" content="Openstack on AArch64/Arm64 via Kolla Ansible"><meta property="og:description" content="OpenStack on AArch64/ARM64 已經可以透過 Kolla-Ansible 直接部署，一般在 x86_64 部署 OpenStack 可以參考 Gene Kuo 的部落格文章 ，我這邊就不再贅述。
這篇主要說明如何在 x86_64 與 Arm64 混合雲的情況下，透過 Kolla-Ansible 直接部署 OpenStack Rocky 並且可以正常使用。"><meta property="og:locale" content="zh_TW"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-10-14T08:10:14+00:00"><meta property="article:modified_time" content="2022-07-09T23:05:13+08:00"><meta property="article:tag" content="Openstack"><meta property="article:tag" content="Arm64"><meta property="article:tag" content="Aarch64"><meta property="og:image" content="https://blog.kojuro.date/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.kojuro.date/logo.png"><meta name=twitter:title content="Openstack on AArch64/Arm64 via Kolla Ansible"><meta name=twitter:description content="OpenStack on AArch64/ARM64 已經可以透過 Kolla-Ansible 直接部署，一般在 x86_64 部署 OpenStack 可以參考 Gene Kuo 的部落格文章 ，我這邊就不再贅述。
這篇主要說明如何在 x86_64 與 Arm64 混合雲的情況下，透過 Kolla-Ansible 直接部署 OpenStack Rocky 並且可以正常使用。"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.kojuro.date/2018/10/2018-10-14-openstack-on-aarch64-arm64-via-kolla-ansible/><link rel=next href=https://blog.kojuro.date/2018/10/2018-10-17-openstack-rocky-cinder-nfs-driver-issue/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Openstack on AArch64/Arm64 via Kolla Ansible","inLanguage":"zh-TW","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.kojuro.date\/2018\/10\/2018-10-14-openstack-on-aarch64-arm64-via-kolla-ansible\/"},"image":["https:\/\/blog.kojuro.date\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"openstack, arm64, aarch64","wordcount":1554,"url":"https:\/\/blog.kojuro.date\/2018\/10\/2018-10-14-openstack-on-aarch64-arm64-via-kolla-ansible\/","datePublished":"2018-10-14T08:10:14+00:00","dateModified":"2022-07-09T23:05:13+08:00","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/blog.kojuro.date\/images\/avatar.png"},"author":{"@type":"Person","name":"Date Huang"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="伊達's work">伊達's work</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/about/>About </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title=切換主題>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="伊達's work">伊達's work</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/about/ title>About</a><a href=javascript:void(0); class="menu-item theme-switch" title=切換主題>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目錄</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Openstack on AArch64/Arm64 via Kolla Ansible</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Date Huang</a></span>&nbsp;<span class=post-category>收錄於 <a href=/categories/openstack/><i class="far fa-folder fa-fw" aria-hidden=true></i>Openstack</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2018-10-14>2018-10-14</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;約 1554 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;預計閱讀 4 分鐘&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目錄</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#基礎架構>基礎架構</a><ul><li><a href=#網路介面>網路介面</a></li><li><a href=#伺服器>伺服器</a></li></ul></li><li><a href=#準備>準備</a><ul><li><a href=#kolla>Kolla</a></li><li><a href=#kolla-ansible>Kolla-Ansible</a></li></ul></li><li><a href=#安裝設定>安裝設定</a><ul><li><a href=#kolla-ansible-設定>Kolla-Ansible 設定</a></li><li><a href=#ansible-inventory-設定>Ansible Inventory 設定</a></li></ul></li><li><a href=#部署>部署</a></li><li><a href=#使用>使用</a></li><li><a href=#openstack-on-aarch64>OpenStack on AArch64</a><ul><li><a href=#映像檔>映像檔</a></li><li><a href=#vnc-console>VNC Console</a></li></ul></li><li><a href=#後記>後記</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></div><div class=content id=content><p>OpenStack on AArch64/ARM64 已經可以透過 Kolla-Ansible 直接部署，一般在 x86_64 部署 OpenStack 可以參考 <a href=https://igene.tw/kolla-ansible-deploy target=_blank rel="noopener noreffer">Gene Kuo 的部落格文章</a> ，我這邊就不再贅述。</p><p>這篇主要說明如何在 x86_64 與 Arm64 混合雲的情況下，透過 Kolla-Ansible 直接部署 OpenStack Rocky 並且可以正常使用。</p><h2 id=基礎架構>基礎架構</h2><p>一個 HA 的 OpenStack 需要至少 4 個節點，分別為 3 個 control node ，與 1 個 compute node，每個節點至少需要 2 個網路介面，不過我下面會使用 3 個網路介面作為範例，將外部與內部的 API 使用分離。這邊使用 3 個 x86_64 control node，以及 1 個 ARM server 作為 compute node</p><h3 id=網路介面>網路介面</h3><ul><li><code>api_interface</code> 為內部 API 使用的介面</li><li><code>neutron_external_interface</code> 為 VM 或是其他 OpenStack 網路功能所對外的介面，無法使用 IP ，如果使用虛擬機則必須要允許這個介面使用 <code>Promiscuous Mode</code></li><li><code>kolla_external_vip_interface</code> 為 HAProxy 所使用對外服務的介面</li></ul><h3 id=伺服器>伺服器</h3><ul><li>Mgmt 作為 Kolla-Ansible 執行的環境</li><li>control01 ~ 03 為 OpenStack Control Node，為 x86</li><li>compute01 為 ARM server ，為OpenStack Compute Node ，欲執行 ARM VM</li></ul><h2 id=準備>準備</h2><h3 id=kolla>Kolla</h3><p>Kolla 並沒有在 Docker Hub 上面預先準備 aarch64 的 image 給大家使用，所以我們必須要自行編譯 OpenStack Kolla image 給 aarch64 使用，於 ARM64 server 中執行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/openstack/kolla -b stable/rocky
</span></span></code></pre></td></tr></table></div></div><p>因為 OpenStack Rocky 預設會透過 Libvirt 尋找可以 PCI Passthrough 以及 SR-IOV 的設備，但是 Libvirt 並無法正確判讀 Cavium ThunderX 網卡功能，所以我們將該功能直接從 OpenStack 之中去除，於 <code>kolla/docker/nova/nova-compute/Dockerfile.j2</code> 中，於 <code>COPY extend_start.sh /usr/local/bin/kolla_nova_extend_start</code> 之前加入以下 patch</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>RUN</span> <span class=n>rm</span> <span class=o>-</span><span class=n>f</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>kolla</span><span class=o>/</span><span class=n>venv</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>python2</span><span class=o>.</span><span class=mi>7</span><span class=o>/</span><span class=n>site</span><span class=o>-</span><span class=n>packages</span><span class=o>/</span><span class=n>nova</span><span class=o>/</span><span class=n>virt</span><span class=o>/</span><span class=n>libvirt</span><span class=o>/</span><span class=n>driver</span><span class=o>.</span><span class=n>pyc</span>
</span></span><span class=line><span class=cl><span class=n>RUN</span> <span class=n>sed</span> <span class=o>-</span><span class=n>i</span> <span class=s2>&#34;/data\[&#39;pci_passthrough_/d&#34;</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>kolla</span><span class=o>/</span><span class=n>venv</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>python2</span><span class=o>.</span><span class=mi>7</span><span class=o>/</span><span class=n>site</span><span class=o>-</span><span class=n>packages</span><span class=o>/</span><span class=n>nova</span><span class=o>/</span><span class=n>virt</span><span class=o>/</span><span class=n>libvirt</span><span class=o>/</span><span class=n>driver</span><span class=o>.</span><span class=n>py</span>
</span></span><span class=line><span class=cl><span class=n>RUN</span> <span class=n>sed</span> <span class=o>-</span><span class=n>i</span> <span class=s2>&#34;/self._get_pci_passthrough_devices()/d&#34;</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>kolla</span><span class=o>/</span><span class=n>venv</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>python2</span><span class=o>.</span><span class=mi>7</span><span class=o>/</span><span class=n>site</span><span class=o>-</span><span class=n>packages</span><span class=o>/</span><span class=n>nova</span><span class=o>/</span><span class=n>virt</span><span class=o>/</span><span class=n>libvirt</span><span class=o>/</span><span class=n>driver</span><span class=o>.</span><span class=n>py</span>
</span></span></code></pre></td></tr></table></div></div><p>並且執行編譯並推送至自架的 Docker Registry 中，在這邊我們推薦來源為 source ，而非 binary (發行版維護)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> kolla
</span></span><span class=line><span class=cl>tools/build.py --base ubuntu --base-arch aarch64 --tag rocky --type <span class=nb>source</span> --registry <span class=p>&amp;</span>lt<span class=p>;</span>Your Registry IP or Hostname<span class=p>&amp;</span>gt<span class=p>;</span>:5000 --push
</span></span></code></pre></td></tr></table></div></div><h3 id=kolla-ansible>Kolla-Ansible</h3><p>pip 中能夠安裝的 Kolla-Ansible 並沒有我們需要的版本，也因為要修改，所以直接使用 upstream 版本會相對方便許多</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/openstack/kolla-ansible -b stable/rocky
</span></span><span class=line><span class=cl>pip install -U ansible
</span></span><span class=line><span class=cl>cp kolla-ansible/etc/kolla/ /etc/kolla
</span></span></code></pre></td></tr></table></div></div><p>該版本似乎存在一些問題，導致 rabbitmq 沒有辦法正確識別參數，所以需要修正。這問題似乎在 commit 5bfcb584275 後修好了，可以考慮直接使用新版的 kolla-ansible</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> kolla-ansible/ansible/roles
</span></span><span class=line><span class=cl>grep -r transport_url <span class=p>|</span> awk -F<span class=s2>&#34;:&#34;</span> <span class=s1>&#39;{print $1}&#39;</span> <span class=p>|</span> xargs -i sed -i <span class=s1>&#39;s|transport_url = {{ rpc_transport_url }}|transport_url = {{ rpc_transport_url }}/|g&#39;</span> <span class=o>{}</span>
</span></span><span class=line><span class=cl>grep -r transport_url <span class=p>|</span> awk -F<span class=s2>&#34;:&#34;</span> <span class=s1>&#39;{print $1}&#39;</span> <span class=p>|</span> xargs -i sed -i <span class=s1>&#39;s|transport_url = {{ notify_transport_url }}|transport_url = {{ notify_transport_url }}/|g&#39;</span> <span class=o>{}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=安裝設定>安裝設定</h2><h3 id=kolla-ansible-設定>Kolla-Ansible 設定</h3><p>Kolla-Ansible 的設定都會存在 /etc/kolla 之中，主要修改 /etc/kolla/globals.yml 來改變參數，此部分先參照 Gene Kuo 的教學文章，我未來再補上，要注意的是必須關閉 fluentd 功能，這功能目前無法用在 AArch64 上面。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>enable_fluentd=&#34;no&#34;
</span></span></code></pre></td></tr></table></div></div><h3 id=ansible-inventory-設定>Ansible Inventory 設定</h3><p>我們先複製預設的多節點部署做為基底修改</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cp kolla-ansible/ansible/inventory/multinode .
</span></span></code></pre></td></tr></table></div></div><p>因為我們要部署混合平台的 OpenStack，即為 Control Node 為 x86 ，Compute Node 為 AArch64 ，我們會利用 <code>multinode</code> 這個 Inventory 覆蓋相關的設定，並確定你的 ansible user 可以不需要密碼直接使用 <code>sudo</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[control]
</span></span><span class=line><span class=cl>control[01:03] ansible_ssh_user=&amp;lt;username&amp;gt; ansible_become=True ansible_private_key_file=&amp;lt;priv key&amp;gt; neutron_external_interface=ens224 api_interface=ens192 storage_interface=ens192 tunnel_interface=ens192 remote_src=True
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[network:children]
</span></span><span class=line><span class=cl>control
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[inner-compute]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[external-compute]
</span></span><span class=line><span class=cl>compute01 ansible_ssh_user=&amp;lt;username&amp;gt; ansible_become=True ansible_private_key_file=&amp;lt;priv key&amp;gt; neutron_external_interface=enP2p1s0f3 api_interface=enP2p1s0f2 storage_interface=enP2p1s0f2 tunnel_interface=enP2p1s0f2 docker_registry=&amp;lt;Your Registry IP&amp;gt;:5000 remote_src=True
</span></span></code></pre></td></tr></table></div></div><h2 id=部署>部署</h2><p>先產生 OpenStack 部署中所需要的所有密碼，密碼會在 <code>/etc/kolla/passwords.yml</code> 之中</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> kolla-ansible
</span></span><span class=line><span class=cl>tools/generate_passwords.py
</span></span></code></pre></td></tr></table></div></div><p>然後安裝必要套件，大部分不太會有意外，但是 AArch64 伺服器上不一定有辦法正確執行，所以推薦先行安裝 <code>docker</code> 與 <code>python-dev</code> 等等套件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tools/koll-ansible -i ../multinode bootstrap-servers
</span></span></code></pre></td></tr></table></div></div><p>部署前測試，會測試相關資源是否被使用到</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tools/kolla-ansible -i ../multinode prechecks
</span></span></code></pre></td></tr></table></div></div><p>實際部署，會從 Registry 中拉取 image 使用，並且傳送設定檔至目標伺服器</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tools/kolla-ansible -i ../multinode deploy
</span></span></code></pre></td></tr></table></div></div><h2 id=使用>使用</h2><p>若部署沒有出現問題，則可以使用 <code>/etc/kolla/passwords.yml</code> 中的 <code>keystone_admin_password</code> ，帳號為 admin 登入 OpenStack 介面</p><p>透過以下指令可以生產 CLI 使用比較方便的 openrc 予以使用，並存在 <code>/etc/kolla/admin-openrc.sh</code> 中</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>tools/kolla-ansible -i ../multinode post-deploy
</span></span></code></pre></td></tr></table></div></div><h2 id=openstack-on-aarch64>OpenStack on AArch64</h2><p>AArch64 會有一些跟 x86 不同的地方，因為 Linaro 已經做了相當多的修改，所以我們必要的修正只有少數一些設定</p><h3 id=映像檔>映像檔</h3><p>開機映像檔需要新增一些參數，讓 AArch64 VM 可以正常運作，我們必須使用 UEFI 映像檔開機，以 Ubuntu Cloud Image 為例，16.04 需要下載檔名含有 <code>uefi</code> 的映像檔，18.04 以後則預設為 UEFI 開機</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>openstack image create <span class=s2>&#34;image display name&#34;</span> --file <span class=s2>&#34;&amp;lt;image file&amp;gt;&#34;</span> --disk-format qcow2 --container-format bare --property <span class=nv>hw_scsi_model</span><span class=o>=</span><span class=s1>&#39;virtio-scsi&#39;</span> --property <span class=nv>hw_disk_bus</span><span class=o>=</span><span class=s1>&#39;scsi&#39;</span> --property <span class=nv>hw_firmware_type</span><span class=o>=</span><span class=s1>&#39;uefi&#39;</span> --public
</span></span></code></pre></td></tr></table></div></div><h3 id=vnc-console>VNC Console</h3><p>AArch64 的顯示並非如 x86 直接使用 vga 設備，而是透過 <code>virtio-gpu-pci</code> 這外部裝置，Ubuntu Cloud Image 中的 Linux Kernel 並沒有預設啟用 <code>virtio-gpu</code> 這個模組，也並沒有預設安裝，所以在 VM 開機完畢之後，需要安裝 <code>linux-modules-extra</code> 的套件，並預設啟動模組以及修改設定。</p><p>於 <code>/etc/default/grub</code> 中，需修改</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GRUB_CMDLINE_LINUX_DEFAULT=&#34;console=tty1&#34;
</span></span></code></pre></td></tr></table></div></div><p>然後執行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo update-grub
</span></span></code></pre></td></tr></table></div></div><p>安裝並預設啟用 <code>virtio-gpu</code> 模組，<code>linux-image-extra-virtual</code> 為虛擬套件，他會安裝其他必要模組</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install -y linux-image-extra-virtual
</span></span></code></pre></td></tr></table></div></div><p>於 <code>/etc/modules</code> 中新增 virtio-gpu</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1># /etc/modules: kernel modules to load at boot time.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># This file contains the names of kernel modules that should be loaded</span>
</span></span><span class=line><span class=cl><span class=c1># at boot time, one per line. Lines beginning with &#34;#&#34; are ignored.</span>
</span></span><span class=line><span class=cl><span class=n>virtio</span><span class=o>-</span><span class=n>gpu</span>
</span></span></code></pre></td></tr></table></div></div><p>並重新打包 <code>initramfs</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo update-initramfs -u
</span></span></code></pre></td></tr></table></div></div><p>重開機後即可於 AArch64 VM 正常使用 VNC console</p><h2 id=後記>後記</h2><p>因為很無聊，所以在 VM 上面安裝了桌面環境來玩看看，但是因為沒有 GPU 加速，所以真的是滿慢的</p><h2 id=reference>Reference</h2><p>[1] <a href=https://igene.tw/kolla-ansible-deploy target=_blank rel="noopener noreffer">透過 Kolla-Ansible 跟 Container 部署 OpenStack</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新於 2022-07-09&nbsp;<a class=git-hash href=https://github.com/dillonzq/LoveIt/commit/0bd9d76eb2fc271cbaca587326084acdeb34546f target=_blank title="commit by Date Huang(tjjh89017@hotmail.com) 0bd9d76eb2fc271cbaca587326084acdeb34546f: update">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>0bd9d76</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/2018/10/2018-10-14-openstack-on-aarch64-arm64-via-kolla-ansible/index.md target=_blank>閱讀原始文檔</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://blog.kojuro.date/2018/10/2018-10-14-openstack-on-aarch64-arm64-via-kolla-ansible/ data-title="Openstack on AArch64/Arm64 via Kolla Ansible" data-hashtags=openstack,arm64,aarch64><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://blog.kojuro.date/2018/10/2018-10-14-openstack-on-aarch64-arm64-via-kolla-ansible/ data-hashtag=openstack><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Linkedin" data-sharer=linkedin data-url=https://blog.kojuro.date/2018/10/2018-10-14-openstack-on-aarch64-arm64-via-kolla-ansible/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/openstack/>Openstack</a>,&nbsp;<a href=/tags/arm64/>Arm64</a>,&nbsp;<a href=/tags/aarch64/>Aarch64</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主頁</a></span></section></div><div class=post-nav><a href=/2018/10/2018-10-17-openstack-rocky-cinder-nfs-driver-issue/ class=next rel=next title="OpenStack Rocky Cinder NFS Driver Issue">OpenStack Rocky Cinder NFS Driver Issue<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.151.0">Hugo</a> 強力驅動 | 主題 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span>&nbsp;|&nbsp;<span class=license>All Rights Reserved</span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到頂部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看評論><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"複製到剪貼板",maxShownLines:50},comment:{},lightgallery:!0}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1YYWDWN3ZY",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-1YYWDWN3ZY" async></script></body></html>