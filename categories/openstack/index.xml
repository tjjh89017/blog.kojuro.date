<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Openstack on 伊達's work</title><link>https://blog.kojuro.date/categories/openstack/</link><description>Recent content in Openstack on 伊達's work</description><generator>Hugo</generator><language>zh-TW</language><lastBuildDate>Sat, 09 Jul 2022 23:20:26 +0800</lastBuildDate><atom:link href="https://blog.kojuro.date/categories/openstack/index.xml" rel="self" type="application/rss+xml"/><item><title>ZFS 使用的經驗</title><link>https://blog.kojuro.date/2018/10/zfs-%E4%BD%BF%E7%94%A8%E7%9A%84%E7%B6%93%E9%A9%97/</link><pubDate>Sat, 20 Oct 2018 17:00:53 +0000</pubDate><guid>https://blog.kojuro.date/2018/10/zfs-%E4%BD%BF%E7%94%A8%E7%9A%84%E7%B6%93%E9%A9%97/</guid><description>&lt;p&gt;我透過 OpenMediaVault 搭配 OMV-zfs plugin 使用 zfs ，UI 能使用的功能依舊很少，所以大部分還是得用 CLI 控制 ZFS 本身，不過可以用 OMV UI 控制很多 file sharing 的設定就已經萬謝了。以下分享一些，使用 ZFS 以來的心得。&lt;/p&gt;</description></item><item><title>Patch Kolla via Template</title><link>https://blog.kojuro.date/2018/10/patch-kolla-via-template/</link><pubDate>Thu, 18 Oct 2018 12:31:32 +0000</pubDate><guid>https://blog.kojuro.date/2018/10/patch-kolla-via-template/</guid><description>&lt;p&gt;Kolla 多少還是有一些不合需求的地方，我們可以透過 Kolla Template 的方式修改 Dockerfile ，不用直接硬修改 Kolla 本身，而是透過 Kolla 提供的 Plugin 安裝接口修正。&lt;/p&gt;
&lt;p&gt;修改的同時可能需要一些 Jinja (Template Engine) 的一些知識，可以參考 &lt;a href="http://jinja.pocoo.org/docs/2.10/" target="_blank" rel="noopener noreffer "&gt;Jinja 官網&lt;/a&gt;的文件，也需要 Dockerfile 的撰寫知識。&lt;/p&gt;</description></item><item><title>Kolla-Ansible Nova Ephemeral Storage on NFS</title><link>https://blog.kojuro.date/2018/10/2018-10-18-kolla-ansible-nova-ephemeral-storage-on-nfs/</link><pubDate>Wed, 17 Oct 2018 17:23:08 +0000</pubDate><guid>https://blog.kojuro.date/2018/10/2018-10-18-kolla-ansible-nova-ephemeral-storage-on-nfs/</guid><description>&lt;p&gt;OpenStack 通常會有兩種儲存 VM 的方式，一個是直接在 Nova-Compute Node 上面的 &lt;code&gt;/var/lib/nova/instances&lt;/code&gt; ，另外一種則是儲存在 Cinder。前者通常也不會真的直接儲存在 Node 上，而是會透過 Shared Storage 儲存，例如 NFS 等等。&lt;/p&gt;
&lt;p&gt;但是因為 OpenStack 會有一些 Lock 機制，偏偏 NFS 不一定實作全部的 Lock 種類，所以會導致 Lock 失敗，進而製作 VM 也跟著失敗。&lt;/p&gt;
&lt;p&gt;Nova 在新增 VM 或是複製 Image 的時候，會考慮處理程序處理的問題，所以會使用 Lock ，以確保沒有正確無誤。透過 oslo.concurrency 處理 Lock，底層透過 fasteners 呼叫 fcntl ，進而失敗。所以我們將 Lock 機制暫時取消掉。目前還無法確定取消掉之後會不會有其他問題存在。&lt;/p&gt;</description></item><item><title>OpenStack Rocky Cinder NFS Driver Issue</title><link>https://blog.kojuro.date/2018/10/2018-10-17-openstack-rocky-cinder-nfs-driver-issue/</link><pubDate>Wed, 17 Oct 2018 07:35:59 +0000</pubDate><guid>https://blog.kojuro.date/2018/10/2018-10-17-openstack-rocky-cinder-nfs-driver-issue/</guid><description>&lt;p&gt;最近使用 Kolla-Ansible 部署 OpenStack Rocky on AArch64/ARM64 發生一些問題，這問題並不只是存在 ARM 上，而是因為發行版所維護的 QEMU 版本已經跟到了 commit &lt;a href="https://github.com/qemu/qemu/commit/ca749954b09b89e22cd69c4949fb7e689b057963" target="_blank" rel="noopener noreffer "&gt;ca749954b09b89e22cd69c4949fb7e689b057963&lt;/a&gt; ，這個 commit 使用到了 &lt;code&gt;F_OFD_SETLK&lt;/code&gt;， NFSv3 正好不支援這類型 lock 操作。&lt;/p&gt;
&lt;p&gt;而這個修改，並沒有根據不同檔案系統不支援 &lt;code&gt;F_OFD_SETLK&lt;/code&gt; 回退 &lt;code&gt;F_SETLK&lt;/code&gt; 的操作，所以只要在現代 Linux 中編譯 QEMU，就會直接使用 &lt;code&gt;F_OFD_SETLK&lt;/code&gt; ，而造成在 NFSv3 上無法使用 lock 進而導致失敗的現象。&lt;/p&gt;
&lt;p&gt;而這問題也不單單只影響 Cinder-Volume，也間接影響 Nova-Compute，如果 VM 要掛載 Volume，而 Cinder 使用 NFS Driver，則會在 Nova-Compute 上也把 NFS 掛載上去給 QEMU 使用。&lt;/p&gt;</description></item><item><title>Openstack on AArch64/Arm64 via Kolla Ansible</title><link>https://blog.kojuro.date/2018/10/2018-10-14-openstack-on-aarch64-arm64-via-kolla-ansible/</link><pubDate>Sun, 14 Oct 2018 08:10:14 +0000</pubDate><guid>https://blog.kojuro.date/2018/10/2018-10-14-openstack-on-aarch64-arm64-via-kolla-ansible/</guid><description>&lt;p&gt;OpenStack on AArch64/ARM64 已經可以透過 Kolla-Ansible 直接部署，一般在 x86_64 部署 OpenStack 可以參考 &lt;a href="https://igene.tw/kolla-ansible-deploy" target="_blank" rel="noopener noreffer "&gt;Gene Kuo 的部落格文章&lt;/a&gt; ，我這邊就不再贅述。&lt;/p&gt;
&lt;p&gt;這篇主要說明如何在 x86_64 與 Arm64 混合雲的情況下，透過 Kolla-Ansible 直接部署 OpenStack Rocky 並且可以正常使用。&lt;/p&gt;</description></item></channel></rss>